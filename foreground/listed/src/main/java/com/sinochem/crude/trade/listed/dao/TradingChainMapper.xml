<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sinochem.crude.trade.listed.dao.TradingChainMapper" >
  <resultMap id="BaseResultMap" type="com.sinochem.crude.trade.listed.domain.TradingChain" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 16 09:45:22 CST 2018.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <id column="serial_number" property="serialNumber" jdbcType="VARCHAR" />
    <result column="demand_id" property="demandId" jdbcType="BIGINT" />
    <result column="uuid" property="uuid" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="operator_sum" property="operatorSum" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="start_time" property="startTime" jdbcType="TIMESTAMP" />
    <result column="deadline" property="deadline" jdbcType="TIMESTAMP" />
    <result column="finish_time" property="finishTime" jdbcType="TIMESTAMP" />
    <result column="operators_id" property="operatorsId" jdbcType="VARCHAR" />
    <result column="alter_time" property="alterTime" jdbcType="TIMESTAMP" />
    <result column="user_created" property="userCreated" jdbcType="BIGINT" />
    <result column="user_modified" property="userModified" jdbcType="BIGINT" />
    <result column="alive_flag" property="aliveFlag" jdbcType="INTEGER" />
    <result column="version" property="version" jdbcType="BIGINT" />
  </resultMap>


  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 16 09:45:22 CST 2018.
    -->
    id, serial_number, demand_id, uuid, status, operator_sum, create_time, start_time, deadline, finish_time,
    operators_id, alter_time, user_created, user_modified, alive_flag, version
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 16 09:45:22 CST 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from trading_chain
    where id = #{id,jdbcType=BIGINT}
  </select>


  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 16 09:45:22 CST 2018.
    -->
    delete from trading_chain
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.sinochem.crude.trade.listed.domain.TradingChain" >

    <selectKey resultType="java.lang.Long" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into trading_chain (id, serial_number, demand_id, uuid,
      status, operator_sum, create_time, 
      start_time, deadline, finish_time, 
      operators_id, alter_time, user_created, 
      user_modified, alive_flag, version
      )
    values (#{id,jdbcType=BIGINT}, #{serialNumber,jdbcType=VARCHAR}, #{demandId,jdbcType=BIGINT}, #{uuid,jdbcType=VARCHAR},
      #{status,jdbcType=INTEGER}, #{operatorSum,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, 
      #{startTime,jdbcType=TIMESTAMP}, #{deadline,jdbcType=TIMESTAMP}, #{finishTime,jdbcType=TIMESTAMP}, 
      #{operatorsId,jdbcType=VARCHAR}, #{alterTime,jdbcType=TIMESTAMP}, #{userCreated,jdbcType=BIGINT}, 
      #{userModified,jdbcType=BIGINT}, #{aliveFlag,jdbcType=INTEGER}, #{version,jdbcType=BIGINT}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.sinochem.crude.trade.listed.domain.TradingChain" >

    <selectKey resultType="java.lang.Long" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into trading_chain
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="serialNumber != null" >
        serial_number,
      </if>
      <if test="demandId != null" >
        demand_id,
      </if>
      <if test="uuid != null" >
        uuid,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="operatorSum != null" >
        operator_sum,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="startTime != null" >
        start_time,
      </if>
      <if test="deadline != null" >
        deadline,
      </if>
      <if test="finishTime != null" >
        finish_time,
      </if>
      <if test="operatorsId != null" >
        operators_id,
      </if>
      <if test="alterTime != null" >
        alter_time,
      </if>
      <if test="userCreated != null" >
        user_created,
      </if>
      <if test="userModified != null" >
        user_modified,
      </if>
      <if test="aliveFlag != null" >
        alive_flag,
      </if>
      <if test="version != null" >
        version,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="serialNumber != null" >
        #{serialNumber,jdbcType=VARCHAR},
      </if>
      <if test="demandId != null" >
        #{demandId,jdbcType=BIGINT},
      </if>
      <if test="uuid != null" >
        #{uuid,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="operatorSum != null" >
        #{operatorSum,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="startTime != null" >
        #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deadline != null" >
        #{deadline,jdbcType=TIMESTAMP},
      </if>
      <if test="finishTime != null" >
        #{finishTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operatorsId != null" >
        #{operatorsId,jdbcType=VARCHAR},
      </if>
      <if test="alterTime != null" >
        #{alterTime,jdbcType=TIMESTAMP},
      </if>
      <if test="userCreated != null" >
        #{userCreated,jdbcType=BIGINT},
      </if>
      <if test="userModified != null" >
        #{userModified,jdbcType=BIGINT},
      </if>
      <if test="aliveFlag != null" >
        #{aliveFlag,jdbcType=INTEGER},
      </if>
      <if test="version != null" >
        #{version,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sinochem.crude.trade.listed.domain.TradingChain" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 16 09:45:22 CST 2018.
    -->
    update trading_chain
    <set >
      <if test="serialNumber != null" >
        serial_number = #{serialNumber,jdbcType=VARCHAR},
      </if>
      <if test="demandId != null" >
        demand_id = #{demandId,jdbcType=BIGINT},
      </if>
      <if test="uuid != null" >
        uuid = #{uuid,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="operatorSum != null" >
        operator_sum = #{operatorSum,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="startTime != null" >
        start_time = #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deadline != null" >
        deadline = #{deadline,jdbcType=TIMESTAMP},
      </if>
      <if test="finishTime != null" >
        finish_time = #{finishTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operatorsId != null" >
        operators_id = #{operatorsId,jdbcType=VARCHAR},
      </if>
      <if test="alterTime != null" >
        alter_time = #{alterTime,jdbcType=TIMESTAMP},
      </if>
      <if test="userCreated != null" >
        user_created = #{userCreated,jdbcType=BIGINT},
      </if>
      <if test="userModified != null" >
        user_modified = #{userModified,jdbcType=BIGINT},
      </if>
      <if test="aliveFlag != null" >
        alive_flag = #{aliveFlag,jdbcType=INTEGER},
      </if>
      <if test="version != null" >
        version = #{version,jdbcType=BIGINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.sinochem.crude.trade.listed.domain.TradingChain" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 16 09:45:22 CST 2018.
    -->
    update trading_chain
    set serial_number = #{serialNumber,jdbcType=VARCHAR},
      demand_id = #{demandId,jdbcType=BIGINT},
      uuid = #{uuid,jdbcType=VARCHAR},
      status = #{status,jdbcType=INTEGER},
      operator_sum = #{operatorSum,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      start_time = #{startTime,jdbcType=TIMESTAMP},
      deadline = #{deadline,jdbcType=TIMESTAMP},
      finish_time = #{finishTime,jdbcType=TIMESTAMP},
      operators_id = #{operatorsId,jdbcType=VARCHAR},
      alter_time = #{alterTime,jdbcType=TIMESTAMP},
      user_created = #{userCreated,jdbcType=BIGINT},
      user_modified = #{userModified,jdbcType=BIGINT},
      alive_flag = #{aliveFlag,jdbcType=INTEGER},
      version = #{version,jdbcType=BIGINT}
    where id = #{id,jdbcType=BIGINT}
  </update>

  <select id="selectByUuid" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 12 19:31:55 CST 2018.
    -->
    select
    <include refid="Base_Column_List" />
    from trading_chain
    where uuid = #{uuid,jdbcType=VARCHAR}
  </select>

  <select id="selectByDemandId" resultMap="BaseResultMap" parameterType="java.lang.Long" >

    select
    <include refid="Base_Column_List" />
    from trading_chain
    where demand_id = #{demandId,jdbcType=BIGINT}
  </select>

  <select id="uniteSelectByQuery" resultMap="BaseResultMap" parameterType="com.sinochem.crude.trade.listed.model.query.TradeChainQuery" >

    select
    <include refid="Base_Column_List" />
    from trading_chain t
    where find_in_set(#{memberId,jdbcType=BIGINT},operators_id)
    <if test="enterpriseId != null and enterpriseId != ''">
      and find_in_set(#{enterpriseId,jdbcType=BIGINT},operators_id)
    </if>
    <if test="tradingChainIndate1 != null and tradingChainIndate1 != ''">
      <![CDATA[   and DATE_FORMAT(t.deadline, '%Y-%m-%d') >=  DATE_FORMAT(#{tradingChainIndate1}, '%Y-%m-%d')   ]]>
    </if>
    <if test="tradingChainIndate2 != null and tradingChainIndate2 != ''">
      <![CDATA[   and DATE_FORMAT(t.deadline, '%Y-%m-%d') <=  DATE_FORMAT(#{tradingChainIndate2}, '%Y-%m-%d')   ]]>
    </if>
    <if test="startTime != null">
      <![CDATA[ AND  t.start_time >= #{startTime,jdbcType=TIMESTAMP} ]]>
    </if>
    <if test="endTime != null">
      <![CDATA[ AND  t.start_time < #{endTime,jdbcType=TIMESTAMP} ]]>
    </if>
    ORDER BY create_time DESC
  </select>

  <resultMap id="involvedEnterpriseVO" type="com.sinochem.crude.trade.listed.model.vo.tradingChainVo.EnterpriseNameByTradingChainVO" >
    <result column="member_id" property="memberId" jdbcType="BIGINT" />
  </resultMap>

  <select id="selectEnterpriseNameByTradingChain" resultMap="involvedEnterpriseVO" parameterType="java.lang.Long" >

    SELECT DISTINCT tcm.member_id
    FROM trading_chain_member tcm
	where EXISTS (
		SELECT 1 FROM trading_chain_member tcmTemp
			WHERE tcm.trading_chain_id = tcmTemp.trading_chain_id
			AND tcmTemp.member_id = #{memberId,jdbcType=BIGINT}
	)
  </select>


</mapper>