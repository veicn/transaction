<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinochem.crude.trade.member.dao.MemberMapper">
    <resultMap id="BaseResultMap" type="com.sinochem.crude.trade.member.domain.Member">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Nov 02 14:14:25 CST 2017.
        -->
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="user_name" jdbcType="VARCHAR" property="userName"/>
        <result column="nick_name" jdbcType="VARCHAR" property="nickName"/>
        <result column="code" jdbcType="VARCHAR" property="code"/>
        <result column="email" jdbcType="VARCHAR" property="email"/>
        <result column="type" jdbcType="VARCHAR" property="type"/>
        <result column="password" jdbcType="VARCHAR" property="password"/>
        <result column="mobile" jdbcType="VARCHAR" property="mobile"/>
        <result column="qq_no" jdbcType="VARCHAR" property="qqNo"/>
        <result column="qq_open_id" jdbcType="VARCHAR" property="qqOpenId"/>
        <result column="head_url" jdbcType="VARCHAR" property="headUrl"/>
        <result column="login_failure_count" jdbcType="INTEGER" property="loginFailureCount"/>
        <result column="login_date" jdbcType="TIMESTAMP" property="loginDate"/>
        <result column="password_recover_key" jdbcType="VARCHAR" property="passwordRecoverKey"/>
        <result column="key_lost_time" jdbcType="TIMESTAMP" property="keyLostTime"/>
        <result column="locked" jdbcType="CHAR" property="locked"/>
        <result column="disable" jdbcType="CHAR" property="disable"/>
        <result column="del_flg" jdbcType="CHAR" property="delFlg"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="creater" jdbcType="BIGINT" property="creater"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
        <result column="updater" jdbcType="BIGINT" property="updater"/>
        <result column="udb_uuid" jdbcType="VARCHAR" property="udbUUid"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Nov 02 14:14:25 CST 2017.
        -->
        id, user_name, nick_name, code, email, type, password, mobile, qq_no, qq_open_id, head_url,
        login_failure_count, login_date, password_recover_key, key_lost_time,
        locked, disable,del_flg, create_time, creater, update_time, updater,udb_uuid
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Nov 02 14:14:25 CST 2017.
        -->
        select
        <include refid="Base_Column_List"/>
        from members
        where id = #{id,jdbcType=BIGINT}
    </select>
    <select id="selectSubMembers" parameterType="com.sinochem.crude.trade.member.domain.Member"
            resultMap="BaseResultMap">
    SELECT
        m.*
    FROM
        members m
    LEFT JOIN accounts a ON m.id = a.s_member_id AND a.m_member_id != a.s_member_id
    WHERE
        (a.m_member_id IS NULL)
    OR (a.paths LIKE CONCAT('%',#{id},',','%'))
  </select>

    <sql id="Where_Column_List">
        where 1=1
        <if test="id != null">
            and id = #{id}
        </if>
        <if test="userName != null">
            and user_name like concat('%',#{userName,jdbcType=VARCHAR},'%')
        </if>
        <if test="nickName != null">
            and nick_name = #{nickName,jdbcType=VARCHAR}
        </if>
        <if test="code != null">
            and code = #{code,jdbcType=VARCHAR}
        </if>
        <if test="email != null">
            and email = #{email,jdbcType=VARCHAR}
        </if>
        <if test="type != null">
            and type = #{type,jdbcType=VARCHAR}
        </if>
        <if test="password != null">
            and password = #{password,jdbcType=VARCHAR}
        </if>
        <if test="mobile != null">
            and mobile = #{mobile,jdbcType=VARCHAR}
        </if>
        <if test="qqNo != null">
            and qq_no = #{qqNo,jdbcType=VARCHAR}
        </if>
        <if test="qqOpenId != null">
            and qq_open_id = #{qqOpenId,jdbcType=VARCHAR}
        </if>
        <if test="headUrl != null">
            and head_url = #{headUrl,jdbcType=VARCHAR}
        </if>
        <if test="loginFailureCount != null">
            and login_failure_count = #{loginFailureCount,jdbcType=INTEGER}
        </if>
        <if test="loginDate != null">
            and login_date = #{loginDate,jdbcType=TIMESTAMP}
        </if>
        <if test="passwordRecoverKey != null">
            and password_recover_key = #{passwordRecoverKey,jdbcType=VARCHAR}
        </if>
        <if test="keyLostTime != null">
            and key_lost_time = #{keyLostTime,jdbcType=TIMESTAMP}
        </if>
        <if test="locked == false">
            and locked = '0'
        </if>
        <if test="locked == true">
            and locked = '1'
        </if>
        <if test="delFlg == false">
            and del_flg = '0'
        </if>
        <if test="disable == false">
            and disable = '0'
        </if>
        <if test="disable == true">
            and disable = '1'
        </if>
        <if test="createTime != null">
            and create_time = #{createTime,jdbcType=TIMESTAMP}
        </if>
        <if test="creater != null">
            and creater = #{creater,jdbcType=BIGINT}
        </if>
        <if test="updateTime != null">
            and update_time = #{updateTime,jdbcType=TIMESTAMP}
        </if>
        <if test="updater != null">
            and updater = #{updater,jdbcType=BIGINT}
        </if>
        <if test="udbUUid != null">
            and udb_uuid = #{udbUUid,jdbcType=BIGINT}
        </if>
    </sql>

    <select id="selectByPrimary" parameterType="com.sinochem.crude.trade.member.domain.Member"
            resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Nov 02 14:14:25 CST 2017.
        -->
        select
        <include refid="Base_Column_List"/>
        from members
        <include refid="Where_Column_List"/>
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Nov 02 14:14:25 CST 2017.
        -->
        delete from members
        where id = #{id,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.sinochem.crude.trade.member.domain.Member">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Nov 02 14:14:25 CST 2017.
        -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into members (user_name,nick_name, code, email,
        type, password, mobile,
        qq_no, qq_open_id, head_url,
        is_account_locked, login_failure_count, login_date,
        password_recover_key, key_lost_time, locked,
        del_flg, create_time, creater,
        update_time, updater,udb_uuid)
        values (#{userName,jdbcType=VARCHAR},#{nickName,jdbcType=VARCHAR}, #{code,jdbcType=VARCHAR},
        #{email,jdbcType=VARCHAR},
        #{type,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR},
        #{qqNo,jdbcType=VARCHAR}, #{qqOpenId,jdbcType=VARCHAR}, #{headUrl,jdbcType=VARCHAR},
        #{loginFailureCount,jdbcType=INTEGER}, #{loginDate,jdbcType=TIMESTAMP},
        #{passwordRecoverKey,jdbcType=VARCHAR}, #{keyLostTime,jdbcType=TIMESTAMP}, #{locked,jdbcType=CHAR},
        #{delFlg,jdbcType=CHAR}, #{createTime,jdbcType=TIMESTAMP}, #{createUser,jdbcType=BIGINT},
        #{updateTime,jdbcType=TIMESTAMP}, #{updateUser,jdbcType=BIGINT},#{udbUUid,jdbcType=BIGINT})
    </insert>
    <insert id="insertSelective" parameterType="com.sinochem.crude.trade.member.domain.Member">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Nov 02 14:14:25 CST 2017.
        -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into members
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userName != null">
                user_name,
            </if>
            <if test="nickName != null">
                nick_name,
            </if>
            <if test="code != null">
                code,
            </if>
            <if test="email != null">
                email,
            </if>
            <if test="type != null">
                type,
            </if>
            <if test="password != null">
                password,
            </if>
            <if test="mobile != null">
                mobile,
            </if>
            <if test="qqNo != null">
                qq_no,
            </if>
            <if test="qqOpenId != null">
                qq_open_id,
            </if>
            <if test="headUrl != null">
                head_url,
            </if>
            <if test="loginFailureCount != null">
                login_failure_count,
            </if>
            <if test="loginDate != null">
                login_date,
            </if>
            <if test="passwordRecoverKey != null">
                password_recover_key,
            </if>
            <if test="keyLostTime != null">
                key_lost_time,
            </if>
            <if test="locked != null">
                locked,
            </if>
            <if test="delFlg != null">
                del_flg,
            </if>
            <if test="disable != null">
                disable,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="createUser != null">
                creater,
            </if>
            <if test="updateTime != null">
                update_time,
            </if>
            <if test="updateUser != null">
                updater,
            </if>
            <if test="udbUUid != null">
                udb_uuid,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userName != null">
                #{userName,jdbcType=VARCHAR},
            </if>
            <if test="nickName != null">
                #{nickName,jdbcTypr=VARCHAR},
            </if>
            <if test="code != null">
                #{code,jdbcType=VARCHAR},
            </if>
            <if test="email != null">
                #{email,jdbcType=VARCHAR},
            </if>
            <if test="type != null">
                #{type,jdbcType=VARCHAR},
            </if>
            <if test="password != null">
                #{password,jdbcType=VARCHAR},
            </if>
            <if test="mobile != null">
                #{mobile,jdbcType=VARCHAR},
            </if>
            <if test="qqNo != null">
                #{qqNo,jdbcType=VARCHAR},
            </if>
            <if test="qqOpenId != null">
                #{qqOpenId,jdbcType=VARCHAR},
            </if>
            <if test="headUrl != null">
                #{headUrl,jdbcType=VARCHAR},
            </if>
            <if test="loginFailureCount != null">
                #{loginFailureCount,jdbcType=INTEGER},
            </if>
            <if test="loginDate != null">
                #{loginDate,jdbcType=TIMESTAMP},
            </if>
            <if test="passwordRecoverKey != null">
                #{passwordRecoverKey,jdbcType=VARCHAR},
            </if>
            <if test="keyLostTime != null">
                #{keyLostTime,jdbcType=TIMESTAMP},
            </if>
            <if test="locked == 1">
                '1',
            </if>
            <if test="locked == 0">
                '0',
            </if>
            <if test="delFlg == true">
                '1',
            </if>
            <if test="delFlg == false">
                '0',
            </if>
            <if test="disable == false">
                '0',
            </if>
            <if test="disable == true">
                '1',
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="createUser != null">
                #{createUser,jdbcType=BIGINT},
            </if>
            <if test="updateTime != null">
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateUser != null">
                #{updateUser,jdbcType=BIGINT},
            </if>
            <if test="udbUUid != null">
                #{udbUUid,jdbcType=BIGINT},
            </if>
        </trim>
    </insert>

    <select id="selectCountByKey" parameterType="com.sinochem.crude.trade.member.domain.Member"
            resultMap="BaseResultMap">
    SELECT mobile,user_name,email FROM members where mobile = #{mobile} or user_name = #{userName} or email = #{email} and del_flg = '0'
  </select>

    <update id="updateByPrimaryKeySelective" parameterType="com.sinochem.crude.trade.member.domain.Member">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Nov 02 14:14:25 CST 2017.
        -->
        update members
        <set>
            <if test="userName != null">
                user_name = #{userName,jdbcType=VARCHAR},
            </if>
            <if test="nickName != null">
                nick_name = #{nickName,jdbcType=VARCHAR},
            </if>
            <if test="code != null">
                code = #{code,jdbcType=VARCHAR},
            </if>
            <if test="email != null">
                email = #{email,jdbcType=VARCHAR},
            </if>
            <if test="type != null">
                type = #{type,jdbcType=VARCHAR},
            </if>
            <if test="password != null">
                password = #{password,jdbcType=VARCHAR},
            </if>
            <if test="mobile != null">
                mobile = #{mobile,jdbcType=VARCHAR},
            </if>
            <if test="qqNo != null">
                qq_no = #{qqNo,jdbcType=VARCHAR},
            </if>
            <if test="qqOpenId != null">
                qq_open_id = #{qqOpenId,jdbcType=VARCHAR},
            </if>
            <if test="headUrl != null">
                head_url = #{headUrl,jdbcType=VARCHAR},
            </if>
            <if test="loginFailureCount != null">
                login_failure_count = #{loginFailureCount,jdbcType=INTEGER},
            </if>
            <if test="loginDate != null">
                login_date = #{loginDate,jdbcType=TIMESTAMP},
            </if>
            <if test="passwordRecoverKey != null">
                password_recover_key = #{passwordRecoverKey,jdbcType=VARCHAR},
            </if>
            <if test="keyLostTime != null">
                key_lost_time = #{keyLostTime,jdbcType=TIMESTAMP},
            </if>
            <if test="locked == true">
                locked = '1',
            </if>
            <if test="locked == false">
                locked = '0',
            </if>
            <if test="disable == true">
                disable = '1',
            </if>
            <if test="disable == false">
                disable = '0',
            </if>
            <if test="delFlg == true">
                del_flg = '1',
            </if>
            <if test="delFlg == false">
                del_flg = '0',
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="createUser != null">
                creater = #{createUser,jdbcType=BIGINT},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateUser != null">
                updater = #{updateUser,jdbcType=BIGINT},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.sinochem.crude.trade.member.domain.Member">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Nov 02 14:14:25 CST 2017.
        -->
        update members
        set user_name = #{userName,jdbcType=VARCHAR},
        nick_name = #{nickName,jdbcType=VARCHAR},
        code = #{code,jdbcType=VARCHAR},
        email = #{email,jdbcType=VARCHAR},
        type = #{type,jdbcType=VARCHAR},
        password = #{password,jdbcType=VARCHAR},
        mobile = #{mobile,jdbcType=VARCHAR},
        qq_no = #{qqNo,jdbcType=VARCHAR},
        qq_open_id = #{qqOpenId,jdbcType=VARCHAR},
        head_url = #{headUrl,jdbcType=VARCHAR},
        login_failure_count = #{loginFailureCount,jdbcType=INTEGER},
        login_date = #{loginDate,jdbcType=TIMESTAMP},
        password_recover_key = #{passwordRecoverKey,jdbcType=VARCHAR},
        key_lost_time = #{keyLostTime,jdbcType=TIMESTAMP},
        locked = #{locked,jdbcType=CHAR},
        del_flg = #{delFlg,jdbcType=CHAR},
        create_time = #{createTime,jdbcType=TIMESTAMP},
        create_user = #{createUser,jdbcType=BIGINT},
        update_time = #{updateTime,jdbcType=TIMESTAMP},
        updater = #{updateUser,jdbcType=BIGINT}
        where id = #{id,jdbcType=BIGINT}
    </update>

    <update id="removeEmailByPrimaryKey" parameterType="com.sinochem.crude.trade.member.domain.Member">
        update members
        <set>
            email= NULL
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>

    <update id="removeMobileByPrimaryKey" parameterType="com.sinochem.crude.trade.member.domain.Member">
        update members
        <set>
            mobile= NULL
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>

    <insert id="insertOm" parameterType="com.sinochem.crude.trade.member.domain.Member"
            useGeneratedKeys="true"
            keyProperty="id">
    <![CDATA[


        INSERT INTO
        members (
        	id ,
        	user_name ,
        	code ,
        	temp_pwd ,
        	locked ,
        	disable ,
        	del_flg ,
        	create_time ,
        	creater ,
        	update_time ,
        	updater,
        	udb_uuid
        ) VALUES (
        	#{id:BIGINT} ,
        	#{userName:VARCHAR} ,
        	#{code:VARCHAR} ,
        	#{tempPwd:VARCHAR} ,
        	#{locked:CHAR} ,
        	#{disable:BIT} ,
        	#{delFlg:BIT} ,
        	SYSDATE() ,
        	#{creater:BIGINT} ,
        	SYSDATE() ,
        	#{updater:BIGINT},
        	#{udbUUid:VARCHAR}
        )


        ]]>
    </insert>


    <select id="selectByUserNameAndPassword" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from members
        where (mobile=#{userName,jdbcType=VARCHAR} OR email=#{userName,jdbcType=VARCHAR} OR
        user_name=#{userName,jdbcType=VARCHAR}) and password=#{password,jdbcType=VARCHAR}
    </select>

    <select id="selectByAccountOrEmail" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from members
        where user_name=#{keyword:VARCHAR} or mobile=#{keyword:VARCHAR} or email=#{keyword:VARCHAR}
    </select>
    <select id="selectMembersByCredential" resultMap="BaseResultMap">
        SELECT
            m.id,
            m.user_name,
            m.mobile,
            m.email
        FROM
            members m
        WHERE
            m.id IN (
                SELECT DISTINCT
                    mc.member_id
                FROM
                    member_credentials mc
                WHERE
                    mc.credentials_code = #{code,jdbcType=VARCHAR}
            )
  </select>
    <select id="selectMembersByRole" resultMap="BaseResultMap">
        SELECT
            m.id,
            m.user_name,
            m.mobile,
            m.email
        FROM
            accounts a
        INNER JOIN accounts_roles ar ON a.id = ar.account_id
        INNER JOIN members m ON a.s_member_id = m.id
        WHERE
            ar.role = #{role,jdbcType=VARCHAR}
  </select>
    <!--udb方法-->
    <select id="selectUdbUUidByMemberId" resultType="java.lang.String" parameterType="java.lang.Long">
        select
        udb_uuid
        from members
        where id = #{id:BIGINT}
    </select>

</mapper>